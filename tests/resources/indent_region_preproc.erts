Code:
  (lambda ()
    (f90-ts-mode)
    (when f90-ts-mode-test-prepare-fun
      (funcall f90-ts-mode-test-prepare-fun))
    (indent-region (point-min) (point-max)))

Point-Char: |

Name: Preproc1
=-=
module my_mod
 public :: foo
#ifdef HOGE
 public :: bar
 public :: baz
#endif
end module my_mod
=-=-=

Name: Preproc2
=-=
subroutine test_sub
     integer :: i
#ifdef DEBUG
     print *, 'debug mode'
     i = i + 1
#else
     i = 0
#endif
end subroutine test_sub
=-=-=

Name: Preproc3
=-=
program main
#ifdef A
 call func_a()
#ifdef B
 call func_b()
#elifdef C
 call func_c()
#endif
#endif
end program main
=-=-=
